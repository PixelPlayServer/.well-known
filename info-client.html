<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelPlay Telemetry Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 800px;
            width: 100%;
            margin: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            opacity: 0.8;
            font-size: 1.1em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat h3 {
            font-size: 2em;
            color: #4ecdc4;
            margin-bottom: 5px;
        }

        .stat p {
            opacity: 0.8;
        }

        .recent-activity {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .recent-activity h2 {
            margin-bottom: 15px;
            color: #ff6b6b;
        }

        .activity-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #4ecdc4;
        }

        .activity-item:last-child {
            margin-bottom: 0;
        }

        .activity-time {
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            display: none;
        }

        .status.success {
            background: #4ecdc4;
            color: white;
        }

        .status.error {
            background: #ff6b6b;
            color: white;
        }

        .webhook-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .webhook-info h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }

        .webhook-info p {
            opacity: 0.8;
            font-size: 0.9em;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="status" id="status"></div>
    
    <div class="container">
        <div class="header">
            <h1>🎮 PixelPlay Telemetry</h1>
            <p>Monitor de lanzamientos y actividad del launcher</p>
        </div>

        <div class="stats">
            <div class="stat">
                <h3 id="totalLaunches">0</h3>
                <p>Lanzamientos Totales</p>
            </div>
            <div class="stat">
                <h3 id="uniqueUsers">0</h3>
                <p>Usuarios Únicos</p>
            </div>
            <div class="stat">
                <h3 id="activeVersions">0</h3>
                <p>Versiones Activas</p>
            </div>
            <div class="stat">
                <h3 id="totalMods">0</h3>
                <p>Mods Instalados</p>
            </div>
        </div>

        <div class="recent-activity">
            <h2>📊 Actividad Reciente</h2>
            <div id="activityList">
                <div class="activity-item">
                    <div class="activity-time">Esperando datos...</div>
                    <div>Sistema iniciado y listo para recibir telemetría</div>
                </div>
            </div>
        </div>

        <div class="webhook-info">
            <h3>🔗 Configuración Discord</h3>
            <p>Los datos se envían automáticamente a Discord cuando se reciben nuevos lanzamientos.</p>
        </div>
    </div>

    <script>
        // Configuración del webhook de Discord
        const DISCORD_WEBHOOK = 'https://discord.com/api/webhooks/1326623918664192114/-td-9pyBub9d7Fbki8o4f0Ifm3A-rG2EZ2WPYZ6ULjVahf3sHaGi-mipSyrxOzmFVx5_';
        
        // Estadísticas en memoria
        let stats = {
            totalLaunches: 0,
            uniqueUsers: new Set(),
            activeVersions: new Set(),
            totalMods: 0,
            recentActivity: []
        };

        // Función para mostrar estado
        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 3000);
        }

        // Función para actualizar estadísticas en pantalla
        function updateStatsDisplay() {
            document.getElementById('totalLaunches').textContent = stats.totalLaunches;
            document.getElementById('uniqueUsers').textContent = stats.uniqueUsers.size;
            document.getElementById('activeVersions').textContent = stats.activeVersions.size;
            document.getElementById('totalMods').textContent = stats.totalMods;
        }

        // Función para agregar actividad reciente
        function addRecentActivity(activity) {
            stats.recentActivity.unshift(activity);
            if (stats.recentActivity.length > 5) {
                stats.recentActivity = stats.recentActivity.slice(0, 5);
            }
            
            const activityList = document.getElementById('activityList');
            activityList.innerHTML = stats.recentActivity.map(activity => `
                <div class="activity-item">
                    <div class="activity-time">${activity.time}</div>
                    <div>${activity.message}</div>
                </div>
            `).join('');
        }

        // Función para enviar a Discord
        async function sendToDiscord(telemetryData) {
            const embed = {
                title: "🚀 Nuevo Lanzamiento de PixelPlay",
                color: 0x4ECDC4,
                timestamp: new Date().toISOString(),
                thumbnail: {
                    url: "https://cdn.discordapp.com/attachments/123456789/minecraft-icon.png"
                },
                fields: [
                    {
                        name: "👤 Usuario",
                        value: `**${telemetryData.auth.username}**\n\`${telemetryData.auth.uuid}\``,
                        inline: true
                    },
                    {
                        name: "🎮 Versión",
                        value: `**${telemetryData.launch.version}**`,
                        inline: true
                    },
                    {
                        name: "🔐 Autenticación",
                        value: telemetryData.auth.type === 'microsoft' ? '✅ Microsoft' : '❌ Offline',
                        inline: true
                    },
                    {
                        name: "🧩 Mods Instalados",
                        value: `**${telemetryData.mods.count}** mods\n(${(telemetryData.mods.totalSize / 1024 / 1024).toFixed(1)} MB)`,
                        inline: true
                    },
                    {
                        name: "📦 Versiones Disponibles",
                        value: `**${telemetryData.minecraft.count}** versiones`,
                        inline: true
                    },
                    {
                        name: "💻 Sistema",
                        value: `${telemetryData.system.platform} ${telemetryData.system.arch}\n${telemetryData.system.cpus} CPUs, ${telemetryData.system.totalMemory}GB RAM`,
                        inline: true
                    }
                ],
                footer: {
                    text: `PixelPlay Launcher v${telemetryData.launcher.version} • Session: ${telemetryData.session_id.slice(0, 8)}`
                }
            };

            // Agregar top mods si existen
            if (telemetryData.mods.tree && telemetryData.mods.tree.length > 0) {
                const topMods = telemetryData.mods.tree
                    .slice(0, 5)
                    .map(mod => `• ${mod.name} (${(mod.size / 1024 / 1024).toFixed(1)}MB)`)
                    .join('\n');
                
                embed.fields.push({
                    name: "🔧 Top Mods",
                    value: topMods,
                    inline: false
                });
            }

            try {
                const response = await fetch(DISCORD_WEBHOOK, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embeds: [embed],
                        username: "PixelPlay Telemetry",
                        avatar_url: "https://cdn.discordapp.com/attachments/123456789/pixelplay-avatar.png"
                    })
                });

                if (response.ok) {
                    showStatus('✅ Enviado a Discord', 'success');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error('Error enviando a Discord:', error);
                showStatus('❌ Error enviando a Discord', 'error');
                return false;
            }
        }

        // Función para procesar telemetría recibida
        function processTelemetry(data) {
            // Actualizar estadísticas
            stats.totalLaunches++;
            stats.uniqueUsers.add(data.auth.uuid);
            stats.activeVersions.add(data.launch.version);
            stats.totalMods = Math.max(stats.totalMods, data.mods.count);

            // Agregar actividad reciente
            const time = new Date().toLocaleTimeString();
            const activity = {
                time: time,
                message: `${data.auth.username} lanzó ${data.launch.version} con ${data.mods.count} mods`
            };
            addRecentActivity(activity);

            // Actualizar display
            updateStatsDisplay();
            
            // Animación de pulso
            document.querySelector('.container').classList.add('pulse');
            setTimeout(() => {
                document.querySelector('.container').classList.remove('pulse');
            }, 500);

            // Enviar a Discord
            sendToDiscord(data);
        }

        // Simular endpoint para recibir datos (en producción esto sería un servidor real)
        // Para desarrollo, puedes usar este endpoint simulado
        function simulateIncomingData() {
            const sampleData = {
                timestamp: new Date().toISOString(),
                session_id: "abc123def456",
                launcher: {
                    name: "PixelPlay",
                    version: "3.0.0"
                },
                auth: {
                    type: "microsoft",
                    uuid: "550e8400-e29b-41d4-a716-446655440000",
                    username: "TestUser",
                    authenticated: true
                },
                system: {
                    platform: "win32",
                    arch: "x64",
                    release: "10.0.19042",
                    cpus: 8,
                    totalMemory: 16,
                    machineId: "test-machine-123"
                },
                minecraft: {
                    count: 5,
                    versions: ["forge-1.20.1", "vanilla-1.19.4", "fabric-1.20.1"]
                },
                mods: {
                    exists: true,
                    count: 127,
                    totalSize: 268435456,
                    tree: [
                        {name: "JEI-1.20.1.jar", size: 2048576, hash: "abc123"},
                        {name: "OptiFine-1.20.1.jar", size: 4096768, hash: "def456"},
                        {name: "JourneyMap-1.20.1.jar", size: 3072384, hash: "ghi789"}
                    ]
                },
                launch: {
                    version: "forge-1.20.1",
                    timestamp: new Date().toISOString()
                }
            };

            processTelemetry(sampleData);
        }

        // Para pruebas - eliminar en producción
        setTimeout(() => {
            showStatus('🔄 Datos de prueba cargados', 'success');
            simulateIncomingData();
        }, 2000);

        // En un servidor real, aquí estaría el endpoint POST
        // app.post('/info-client', (req, res) => {
        //     processTelemetry(req.body);
        //     res.json({ success: true });
        // });

        console.log('🚀 PixelPlay Telemetry Dashboard iniciado');
        console.log('📡 Esperando datos de telemetría...');
        console.log('🔗 Discord webhook configurado');
    </script>
</body>
</html>
